name: Example assembly
description: Sample assembly file

labels:
  region: canada,usa

spec:
  env:
    - name: AWS_REGION
      value: ${AWS_REGION}
    - name: AWS_ACCESS_KEY_ID
      value: ${AWS_ACCESS_KEY_ID}
    - name: AWS_SECRET_ACCESS_KEY
      value: ${AWS_SECRET_ACCESS_KEY}
    - name: AZURE_STORAGE_ACCOUNT
      value: ${AZURE_STORAGE_ACCOUNT}
    - name: AZURE_STORAGE_SHARED_KEY
      value: ${AZURE_STORAGE_SHARED_KEY}
    - name: KX_TRACE_OBJSTR
      value: "1"   
    - name: KX_KURL_DEBUG_LOG          
      value: "1"

# Database schema
tables:
  trade:
    description: trade data
    type: partitioned
    blockSize: 10000
    prtnCol: Date_Time
    sortColsOrd: RIC
    sortColsDisk: RIC
    columns:
      - name: RIC
        description: sym
        type: symbol
        attrMem: grouped
        attrDisk: parted
        attrOrd: parted
      - name: Date_Time
        description: time
        type: timestamp
      - name: Open
        description: open
        type: float
      - name: High
        description: high
        type: float
      - name: Low
        description: low
        type: float
      - name: Price
        description: price
        type: float
      - name: Volume
        description: vol
        type: float    
  
  xref:
    description: Ref data
    type: partitioned
    blockSize: 10000
    prtnCol: Date_Time
    sortColsOrd: RIC
    sortColsDisk: RIC
    columns:
      - name: RIC
        description: Symbol name
        type: symbol
        attrMem: grouped
        attrDisk: parted
        attrOrd: parted
      - name: Date_Time
        description: time
        type: timestamp
      - name: ISIN
        description: col
        type: char
      - name: Type
        description: col
        type: string
      - name: Domain
        description: col
        type: string        
      - name: Trade_Price_Currency
        description: col
        type: string
      - name: Ex_Cntrb_ID
        description: col
        type: string
                    

# Message bus configuration
bus:
  stream:   
    protocol: custom
    nodes: tp:5010
    topic: dataStream

# Database mount configuration
mounts:
  rdb:
    type: stream
    baseURI: file:///mnt/foo/i/
    partition: none
  idb:
    type: local
    baseURI: file:///data/db/idb
    partition: ordinal
  hdb:
    type: local
    baseURI: file:///data/db/hdb
    partition: date      


# Service configuration
elements:
  rc:
    host: sgrc
    port: 5060
    timeout: 30000
  
  # SM configuration (also used by EOI, EOD, and DBM)
  sm:
    description: Storage manager
    source: stream
    # Tier configuration
    tiers:
      - name: stream
        mount: rdb
      - name: idb
        mount: idb
        schedule:
          freq: 0D00:10:00 # every 10 minutes
      - name: ondisk
        mount: hdb
        schedule:
          freq: 1D00:00:00 # every day
          snap:   01:35:00 # at 1:35 AM
        retain:
          time: 2 days
          rows: 200000 
      - name: s3
        mount: hdb
        store: s3://bitmex-hdb/db          
    disableDiscovery: true  # Disables registering with discovery
  dap:
    # These configs apply to all DA below
    gwAssembly: gw-assembly
    smEndpoints: sm:10001
    instances:
      RDB:
        # Config specific to DAPs with a KXI_SC of RDB
        mountName: rdb # Must match name of mount in "mounts" section
      IDB:
        # Config specific to DAPs with a KXI_SC of IDB
        mountName: idb
      HDB:
        # Config specific to DAPs with a KXI_SC of HDB
        mountName: hdb